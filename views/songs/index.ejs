<%- include('../partials/header.ejs') %>

<div class="main-container">

    <!-- First Div: Song Search Form -->
    <div class="search-container animate__animated animate__fadeInRight">
        <h1>ADD A SONG</h1>
        <% if (user) { %>
            <form class="Form" action="/songs" method="POST">
                <fieldset>
                    <legend><em>YOUR REQUEST:</em></legend>
                    <div class="inputBox">
                        <input type="text" id="title" name="title" size="30" required>
                        <label for="title">Song Title:</label>
                    </div>
                    
                    <div class="inputBox">
                        <input type="text" id="artist" name="artist" size="30" required>
                        <label for="artist">Artist:</label>
                    </div>
                
                    <div class="inputBox">
                        <input type="url" id="youTubeURL" name="youTubeURL" size="30" required
                        pattern="https?://(youtu\.be/|www\.youtube\.com/watch\?v=).*" 
                        title="Please enter a valid YouTube URL">
                        <label for="youTubeURL">YouTube URL:</label>
                    </div>
                </fieldset>
                    
                <div>
                    <button type="submit">Add Song</button>
                </div>
            </form>
        <% } else { %>
            <!-- Display sign-up/login invitation if the user is not logged in -->
            <p>Please <a href="/auth/login">log in</a> or <a href="/auth/sign-up">sign up</a> to add a song to the queue.</p>
        <% } %>
    </div>

    <!-- Second Div: Queue Container -->
    <div class="queue-container animate__animated animate__flipInY">
        <div class="queue-title">
            <h1>QUEUE</h1>
        </div>
        <% if (songs.length === 0) { %>
            <h1>There are no songs in the queue.</h1>
        <% } else { %>
        <div class="request-card">
                <% songs.forEach(song => { %>
                    <div class="requestItem <% if (song.played) { %> played <% } %>">
                        <%- include('../partials/recordIcon.ejs') %>
                        <div class="songInformation">

                        <% if (song.user && user && song.user._id.equals(user._id)) { %> 
                            <a href="/songs/<%= song._id %>"><%= song.title %></a>
                        <% } else { %>
                            <%= song.title %>
                        <% } %>

                        by <%= song.artist %><br>

                        <em>Requested by: <%= song.user ? song.user.name : 'Deleted User' %></em> &nbsp; &nbsp; | &nbsp; &nbsp; 
                        <a href="#" onclick="openInIframe('<%= song.youTubeURL %>', this, '<%= song._id %>')">▶ Play</a> &nbsp; &nbsp; | &nbsp; &nbsp;
            
                        <% if (song.user && user && song.user._id.equals(user._id)) { %>
                            <form action="/songs/<%= song._id %>?_method=DELETE" method="POST" style="display:inline;">
                                <button class="smallBtn" type="submit">❌ DELETE</button> 
                            </form>
                        <% } %>

                        </div>
                    </div>    
                    <!-- </li> -->
                <% }) %>
            <!-- </ul> -->
        </div>        
        <% } %>
        <a class="backLink" href="/songs/new" style="text-decoration: none;">➕ Request a New Song</a>
    </div>

    <!-- Third Div: Media Player -->
    <div class="mediaPlayer animate__animated animate__fadeInLeft">
        <h1>NOW PLAYING</h1>
        <iframe id="videoPlayer"></iframe>
    </div>
</div>

<%- include('../partials/footer.ejs') %>
